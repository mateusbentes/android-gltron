<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>net9.0-ios</TargetFramework>
    <OutputType>Exe</OutputType>

    <RootNamespace>GltronMobileGame</RootNamespace>
    <AssemblyName>GltronMobileGame.iOS</AssemblyName>

    <!-- iOS app metadata -->
    <RuntimeIdentifier>ios-arm64</RuntimeIdentifier>
    <SupportedOSPlatformVersion>11.0</SupportedOSPlatformVersion>
    <ApplicationId>gltron.org.gltronmobile.ios</ApplicationId>
    <ApplicationDisplayVersion>1.0</ApplicationDisplayVersion>
    <ApplicationVersion>1</ApplicationVersion>

    <!-- FNA Configuration -->
    <EnableDefaultCompileItems>false</EnableDefaultCompileItems>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <DefineConstants>$(DefineConstants);FNA</DefineConstants>
    <!-- Disable SDK auto-generated assembly info to avoid conflicts with FNA -->
    <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
  </PropertyGroup>

  <!-- Explicitly include our game files -->
  <ItemGroup>
    <Compile Include="..\GltronMobileGame\*.cs" />
    <Compile Include="..\GltronMobileGame\Video\*.cs" />
    <Compile Include="..\GltronMobileGame\Sound\*.cs" />
  </ItemGroup>

  <!-- Reference FNA as a proper project dependency -->
  <ItemGroup>
    <ProjectReference Include="..\GltronMobileGame\FNA\FNA.NetStandard.csproj" />
  </ItemGroup>

  <!-- Shared Engine -->
  <ItemGroup>
    <ProjectReference Include="..\GltronMobileEngine\GltronMobileEngine.csproj" />
  </ItemGroup>

  <!-- Game files are now explicitly included above with FNA -->

  <!-- FNA Content (raw files, not XNBs) -->
  <ItemGroup>
    <BundleResource Include="..\GltronMobileGame\Content\**\*.*"
                    Link="Content\%(RecursiveDir)%(Filename)%(Extension)" />
  </ItemGroup>

  <!-- FNA iOS Native Frameworks -->
  <ItemGroup>
    <!-- SDL2 Framework (required) -->
    <NativeReference Include="Frameworks\SDL2.framework" Condition="Exists('Frameworks\SDL2.framework')">
      <Kind>Framework</Kind>
      <Frameworks>SDL2</Frameworks>
    </NativeReference>
    
    <!-- OpenAL Framework (required for audio) -->
    <NativeReference Include="Frameworks\OpenAL.framework" Condition="Exists('Frameworks\OpenAL.framework')">
      <Kind>Framework</Kind>
      <Frameworks>OpenAL</Frameworks>
    </NativeReference>
    
    <!-- Theoraplay Framework (optional for video) -->
    <NativeReference Include="Frameworks\Theoraplay.framework" Condition="Exists('Frameworks\Theoraplay.framework')">
      <Kind>Framework</Kind>
      <Frameworks>Theoraplay</Frameworks>
    </NativeReference>
  </ItemGroup>
  
  <!-- iOS-specific FNA configuration -->
  <PropertyGroup>
    <MtouchArch>ARM64</MtouchArch>
    <MtouchLink>SdkOnly</MtouchLink>
    <MtouchDebug Condition="'$(Configuration)' == 'Debug'">true</MtouchDebug>
    <MtouchDebug Condition="'$(Configuration)' == 'Release'">false</MtouchDebug>
    <CodesignKey>iPhone Developer</CodesignKey>
    <IOSDebuggerPort>10000</IOSDebuggerPort>
    
    <!-- FNA iOS-specific settings -->
    <SupportedOSPlatformVersion>12.0</SupportedOSPlatformVersion>
    <MtouchUseLlvm>true</MtouchUseLlvm>
    <MtouchFloat32>true</MtouchFloat32>
    
    <!-- Enable bitcode for App Store -->
    <MtouchEnableBitcode Condition="'$(Configuration)' == 'Release'">true</MtouchEnableBitcode>
    <MtouchEnableBitcode Condition="'$(Configuration)' == 'Debug'">false</MtouchEnableBitcode>
  </PropertyGroup>
  
  <!-- iOS Framework fallbacks for missing FNA frameworks -->
  <PropertyGroup Condition="!Exists('Frameworks\SDL2.framework') OR !Exists('Frameworks\OpenAL.framework')">
    <_FNAFrameworksMissing>true</_FNAFrameworksMissing>
  </PropertyGroup>
  
  <!-- Warning for missing frameworks -->
  <Target Name="WarnMissingFrameworks" BeforeTargets="Build" Condition="'$(_FNAFrameworksMissing)' == 'true'">
    <Warning Text="âš ï¸ FNA iOS frameworks missing! Download SDL2.framework and OpenAL.framework to GltronMobileGame.iOS/Frameworks/ for full functionality." />
    <Message Text="ðŸ“ iOS will use system frameworks as fallback, but functionality may be limited." Importance="high" />
  </Target>

</Project>
